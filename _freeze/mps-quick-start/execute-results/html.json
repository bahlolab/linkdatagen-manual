{
  "hash": "b72671e0977cadca672a8348c1c84631",
  "result": {
    "markdown": "# MPS quick start {#sec-mps-quick-start}\n\n::: callout-warning\n## Work in progress\n\nThis manual is a work in progress. Until it is complete, please continue using LINKDATAGEN from <https://bioinf.wehi.edu.au/software/linkdatagen/>.\n:::\n\nThis chapter written by Katherine Smith and updated by Rick Tankard, with help from Thomas Scerri.\n\n::: callout-note\nThe commands listed here are examples. You will need to modify filenames and options according to your circumstances. Please consult the @sec-linkdatagenpl and @sec-vcf2linkdatagenpl documentation for a detailed description of options available.\n:::\n\n::: callout-note\nThe following commands assume the bash shell (or similar, such as zsh) is being used. This is usually the default on Linux.\n:::\n\n## Downloading scripts and annotations\n\nDownload `linkdatagen.pl` and `vcf2linkdatagen.pl` according to the instructions in @sec-download.\n\nBefore you begin with `vcf2linkdatagen.pl`, decide which HapMap population you want to use to obtain population allele frequencies for linkage analysis, then choose the appropriate annotation (HapMap II or HapMap III). The eleven populations available have the codes ASW, CEU, CHB, CHD, GIH, JPT, LWK, MEX, MKK, TSI and YRI. Most populations only have frequencies available for the HapMap III annotation. CHB, CEU, JPT and YRI frequencies are available for both annotations, but the HapMap II annotation is recommended for theses populations as this contains more markers than HapMap III. See @sec-choosingPopulation for recommendations on choosing a population. For the rest of this example, we will use the HapMap II annotation and specify CEU population allele frequencies.\n\nDownload HapMap Phase II and/or HapMap Phase III files relevant to your genome build. These are provided in a .tar.gz file. TODO: Bundle annotations in a .tar.gz file.\n\n-   hg38 (GRch38)\n    -   Hapmap Phase II:\n        -   annotHapMap2U_hg38.txt.gz\n        -   annotHapMap2U_hg38.dbsnp_138.vcf\n        -   annotHapMap2U_hg38.dbsnp_138.vcf.idx\n    -   HapMap Phase III:\n        -   annotHapMap3U_hg38.txt.gz\n        -   annotHapMap3U_hg38.dbsnp_138.vcf\n        -   annotHapMap3U_hg38.dbsnp_138.vcf.idx\n-   hg19 (GRch37)\n    -   Hapmap Phase II:\n        -   annotHapMap2U_hg19.txt.gz\n        -   annotHapMap2U_hg19.dbsnp_138.vcf\n        -   annotHapMap2U_hg19.dbsnp_138.vcf.idx\n    -   HapMap Phase III:\n        -   annotHapMap3U_hg19.txt.gz\n        -   annotHapMap3U_hg19.dbsnp_138.vcf\n        -   annotHapMap3U_hg19.dbsnp_138.vcf.idx\n\nTODO: change annotation file names for hg19 to include \"hg19\", as above.\n\nGenotyping should be performed with GATK HaplotypeCaller (SAMtools mpileup and GATK UnifiedGenotyper are supported but not recommended, see the manual at [r997](https://github.com/bahlolab/linkdatagen/releases/tag/r997) for use of these tools).\n\nCreate an Analysis-Ready Reads BAM file according to the [Data pre-processing for variant discovery](https://gatk.broadinstitute.org/hc/en-us/articles/360035535912-Data-pre-processing-for-variant-discovery) pipeline to hg38 or hg19. The choice of aligner should not matter too much, though we have only tested the use of BWA MEM and Bowtie2.\n\nVcf2linkdatagen.pl assumes that chromosomes are named chr1, chr2, ... chrX rather than 1,2,...,X. (TODO: this may no longer be the case - I think I saw that \"chr\" is optional in the regex)\n\nGenotype your samples with GATK.\n\nRun the following GATK command on each sample:\n\n    # Change these parameters according to your situation\n    LINKDATAGEN_annotation=<annotation_directory>\n    genome=hg38\n    hapmapvcf=\"$LINKDATAGEN_annotation/annotHapMap2U_hg38.dbsnp_138.vcf\"\n    FASTA=/path/to/reference/Homo_sapiens_assembly38.fasta\n    bam=<input_bam_file_path>\n    outgvcf=gvcf/<sample_name>.g.vcf.gz\n\n    mkdir -p gvcf\n\n    gatk --java-options \"-Xmx4g\" \\\n        HaplotypeCaller \\\n        --reference \"$FASTA\" \\\n        --input \"$bam\" \\\n        --output \"$outgvcf\" \\\n        --dbsnp \"$hapmapvcf\" \\\n        --intervals \"$hapmapvcf\" \\\n        --alleles \"$hapmapvcf\" \\\n        --output-mode EMIT_ALL_CONFIDENT_SITES \\\n        -ERC GVCF\n\nOne this is done, run GATK CombineGVCFs and GenotypeGVCFs\n\n    gatk --java-options \"-Xmx4g\" \\\n        CombineGVCFs \\\n        --reference \"$FASTA\" \\\n        --variant gvcf/<sample_name1>.g.vcf \\\n        --variant gvcf/<sample_name2>.g.vcf \\\n        --variant gvcf/<sample_name3>.g.vcf \\\n        --variant gvcf/<sample_name4>.g.vcf \\\n        --output gvcf/cohort.g.vcf.gz\n        \n    mkdir -p vcf\n        \n    gatk --java-options \"-Xmx4g\" \\\n        GenotypeGVCFs \\\n        --reference \"$FASTA\" \\\n        --dbsnp $hapmapvcf\" \\\n        --intervals $hapmapvcf\" \\\n        --variant gvcf/cohort.g.vcf.gz \\\n        --output vcf/cohort.vcf.gz\n\nThese commands genotype HapMap Phase II SNPs.\n\nNext, run vcf2linkdatagen.pl to convert variant calls from VCF to BRLMM format. The BRLMM file will contain a column of SNP IDs followed by a column of genotypes for each individual. Genotypes will be coded 0 for AA, 1 for AB, 2 for BB or -1 for missing. A is the alphabetically lowest allele and B the alphabetically highest allele on the plus strand, i.e. for a C/T SNP 0=CC and 2=TT.\n\n    LDGPATH=/path/to/linkdatagen/directory\n    perl \"$LDGPATH/vcf2linkdatagen.pl\" \\\n        -variantCaller haplotypeCaller \\\n        -annotfile \"$LINKDATAGEN_annotation/annotHapMap2U_hg38.txt\" \\\n        -pop CEU \\\n        -mindepth 10 \\\n        -missingness 0 \\\n        vcf/cohort.vcf.gz \\\n        > cohort.brlmm\n\n`-mindepth 10` specifies that a SNP's genotypes should only be printed if the SNP location has a minimum read depth (coverage) of ten high-quality reads.\n\n`-pop CEU` specifiesthat CEU population frequencies should be used. These are the default settings.\n\nThe `-missingness` argument specifies the maximum proportion of missing genotype calls for a SNP to be output to the BRLMM file. `-missingness 0` specifies that only SNPs with non-missing genotypes for all samples should be printed to the BRLMM file. The default is `-missingness 1`, meaning that any amount of missingness is allowed.\n\nType `vcf2linkdatagen.pl -help` or see @sec-vcf2linkdatagenpl to learn more about these and other options.\n\nCreate a pedigree file and a whichsamples file for `linkdatagen.pl`. The whichsamples file consists of a single line of space-separated numbers; the *k*th number indicates the column number of the BRLMM file that contains genotypes for the individual specified in the *k*th row of your pedigree file. The first column of genotypes in the BRLMM file is column 1. Refer to the `linkdatagen.pl` documentation in @sec-linkdatagenpl for more detail. An example whichsamples file `cohort.ws` looks like:\n\n    1 2 3 4 5 0 0 0 0 0 0\n\nWith ped file `cohort.ped` (tab separated):\n\n```\ncohort\t5\t1\t2\t1\t2\ncohort\t6\t10\t8\t1\t2\ncohort\t7\t10\t8\t2\t2\ncohort\t8\t5\t11\t2\t2\ncohort\t9\t5\t11\t1\t2\ncohort\t1\t0\t0\t1\t0\ncohort\t2\t0\t0\t2\t0\ncohort\t3\t1\t2\t1\t0\ncohort\t4\t0\t0\t2\t1\ncohort\t10\t0\t0\t1\t1\ncohort\t11\t0\t0\t2\t1\n```\n\nOnly individuals 5 to 9 have MPS data.\nA diagram of this pedigree file is given here:\n\n::: {.cell}\n::: {.cell-output-display}\n![](mps-quick-start_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\nYou are now ready to run `linkdatagen.pl` to create input files for linkage analysis. Here is an example command that will generate MERLIN (see <http://www.sph.umich.edu/csg/abecasis/merlin/download/>) input files.\n\n    perl \"$LDGPATH/linkdatagen.pl\" \\\n        -data m \\\n        -pedfile cohort.ped \\\n        -whichSamplesFile cohort.ws \\\n        -callFile cohort.brlmm \\\n        -annotFile $LINKDATAGEN_annotation/annotHapMap2U_hg38.txt \\\n        -pop CEU \\\n        -binsize 0.3 \\\n        -MendelErrors removeSNPs \\\n        -removeWFHBS \\\n        -prog me \\\n        -outputDir cohort\n\n\n`linkdatagen.pl` can create input files for many other programs, e.g. ALLEGRO. \nRefer to @sec-linkdatagenpl for further details concerning the `-prog` option and other options available.\n\nYou may wish to specify the `-removeWFHBS` option, which requests that uninformative SNPs '\n(those for which all samples within a family have identical homozygous genotypes) are discarded. \nThis should not be done if you only have genotypes from affected samples. \nRefer to @sec-wfhbsMarkers Within/whole-family homozygosity-by-state (\"uninformative\") markers' in the linkdatagen.pl documentation for further details.\n\nIf you are performing parametric linkage analysis, don't forget to create a file `param.tbl` specifying the genetic model (see <http://www.sph.umich.edu/csg/abecasis/merlin/tour/parametric.html>). \nYou are now ready to perform linkage analysis using MERLIN:\n\n```\ncd cohort_merlin\nfor runfile in *in;\ndo\n  bash $runfile\ndone\n\n```\n",
    "supporting": [
      "mps-quick-start_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}